apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: tracking-api
  namespace: argocd
  labels:
    app.kubernetes.io/name: tracking-api
    app.kubernetes.io/part-of: vietmap-live
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  # Project reference
  project: vietmap-live
  
  # Source configuration
  source:
    repoURL: https://github.com/trongtqFX21166/vml_argocd.git
    targetRevision: HEAD
    path: vml/dev/argocd/base
    # Only deploy tracking-api resources
    kustomize:
      namePrefix: ""
      nameSuffix: ""
      resources:
      - tracking-api-deployment.yaml
      - tracking-api-service.yaml
  
  # Destination
  destination:
    server: https://kubernetes.default.svc
    namespace: vietmap-live
  
  # Sync policy
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
    - CreateNamespace=true
    - ApplyOutOfSyncOnly=true
    retry:
      limit: 3
      backoff:
        duration: 5s
        factor: 2
        maxDuration: 1m
  
  # Keep last 5 revisions
  revisionHistoryLimit: 1
  
  # Application info
  info:
  - name: 'Service'
    value: 'Tracking API'
  - name: 'Environment'
    value: 'Development'
  - name: 'Port'
    value: '6002'
  - name: 'URL'
    value: 'http://tracking-api.vietmap-live.svc.cluster.local'

